// https://pages.stern.nyu.edu/~adamodar/New_Home_Page/datafile/countrytaxrates.html

export const MARGINAL_TAX_BY_COUNTRY = {
  Afghanistan: 0.2,
  "Aland Islands": 0.2,
  Albania: 0.15,
  Algeria: 0.26,
  "American Samoa": 0.34,
  Andorra: 0.1,
  Angola: 0.25,
  Anguilla: 0.0,
  "Antigua and Barbuda": 0.25,
  Argentina: 0.35,
  Armenia: 0.18,
  Aruba: 0.22,
  Australia: 0.3,
  Austria: 0.24,
  Azerbaijan: 0.2,
  Bahamas: 0.0,
  Bahrain: 0.0,
  Bangladesh: 0.275,
  Barbados: 0.055,
  Belarus: 0.2,
  Belgium: 0.25,
  Belize: 0.0,
  Benin: 0.3,
  Bermuda: 0.0,
  Bhutan: 0.25,
  "Bolivia (Plurinational State of)": 0.25,
  "Bonaire, Sint Eustatius and Saba": 0.258,
  "Bosnia and Herzegovina": 0.1,
  Botswana: 0.22,
  Brazil: 0.34,
  "British Virgin Islands": 0.0,
  "Brunei Darussalam": 0.185,
  Bulgaria: 0.1,
  "Burkina Faso": 0.275,
  Burundi: 0.3,
  "Cabo Verde": 0.224,
  Cambodia: 0.2,
  Cameroon: 0.33,
  Canada: 0.262,
  "Cayman Islands": 0.0,
  "Central African Republic": 0.3,
  Chad: 0.35,
  Chile: 0.27,
  China: 0.25,
  "China, Hong Kong Special Administrative Re": 0.165,
  "China, Macao Special Administrative Region": 0.12,
  Colombia: 0.35,
  Comoros: 0.5,
  Congo: 0.28,
  "Cook Islands": 0.2,
  "Costa Rica": 0.3,
  "Cote d'Ivoire": 0.25,
  Croatia: 0.18,
  Cuba: 0.35,
  Curacao: 0.22,
  Cyprus: 0.125,
  Czechia: 0.19,
  "Democratic Republic of the Congo": 0.3,
  Denmark: 0.22,
  Djibouti: 0.25,
  Dominica: 0.25,
  "Dominican Republic": 0.27,
  Ecuador: 0.25,
  Egypt: 0.225,
  "El Salvador": 0.3,
  "Equatorial Guinea": 0.35,
  Eritrea: 0.3,
  Estonia: 0.2,
  Ethiopia: 0.3,
  "Falkland Islands (Malvinas)": 0.26,
  "Faroe Islands": 0.18,
  Fiji: 0.2,
  Finland: 0.2,
  France: 0.258,
  "French Polynesia": 0.25,
  Gabon: 0.3,
  Gambia: 0.27,
  Georgia: 0.15,
  Germany: 0.299,
  Ghana: 0.25,
  Gibraltar: 0.125,
  Greece: 0.22,
  Greenland: 0.265,
  Grenada: 0.28,
  Guam: 0.21,
  Guatemala: 0.25,
  Guernsey: 0.0,
  Guinea: 0.25,
  "Guinea-Bissau": 0.25,
  Guyana: 0.25,
  Haiti: 0.3,
  Honduras: 0.3,
  Hungary: 0.09,
  Iceland: 0.2,
  India: 0.3,
  Indonesia: 0.22,
  "Iran (Islamic Republic of)": 0.25,
  Iraq: 0.15,
  Ireland: 0.125,
  "Isle of Man": 0.0,
  Israel: 0.23,
  Italy: 0.278,
  Jamaica: 0.25,
  Japan: 0.297,
  Jersey: 0.0,
  Jordan: 0.2,
  Kazakhstan: 0.2,
  Kenya: 0.3,
  Kiribati: 0.3,
  "Kosovo, Republic of": 0.1,
  Kuwait: 0.15,
  Kyrgyzstan: 0.1,
  "Lao People's Democratic Republic": 0.2,
  Latvia: 0.2,
  Lebanon: 0.17,
  Lesotho: 0.25,
  Liberia: 0.25,
  Libya: 0.2,
  Liechtenstein: 0.125,
  Lithuania: 0.15,
  Luxembourg: 0.249,
  Madagascar: 0.2,
  Malawi: 0.3,
  Malaysia: 0.24,
  Maldives: 0.15,
  Mali: 0.3,
  Malta: 0.35,
  Mauritania: 0.25,
  Mauritius: 0.15,
  Mexico: 0.3,
  "Micronesia (Federated States of)": 0.3,
  Monaco: 0.25,
  Mongolia: 0.25,
  Montenegro: 0.15,
  Montserrat: 0.3,
  Morocco: 0.32,
  Mozambique: 0.32,
  Myanmar: 0.22,
  Namibia: 0.32,
  Nauru: 0.25,
  Nepal: 0.25,
  Netherlands: 0.258,
  "New Caledonia": 0.3,
  "New Zealand": 0.28,
  Nicaragua: 0.3,
  Niger: 0.3,
  Nigeria: 0.3,
  Niue: 0.3,
  "Northern Mariana Islands": 0.21,
  Norway: 0.22,
  Oman: 0.15,
  Pakistan: 0.29,
  Panama: 0.25,
  "Papua New Guinea": 0.3,
  Paraguay: 0.1,
  Peru: 0.295,
  Philippines: 0.25,
  Poland: 0.19,
  Portugal: 0.315,
  "Puerto Rico": 0.375,
  Qatar: 0.1,
  "Republic of Korea": 0.265,
  "Republic of Moldova": 0.12,
  Romania: 0.16,
  "Russian Federation": 0.2,
  Rwanda: 0.3,
  "Saint Barthelemy": 0.0,
  "Saint Helena": 0.25,
  "Saint Kitts and Nevis": 0.33,
  "Saint Lucia": 0.3,
  "Saint Martin (French Part)": 0.2,
  "Saint Vincent and the Grenadines": 0.28,
  Samoa: 0.27,
  "San Marino": 0.17,
  "Sao Tome and Principe": 0.25,
  "Saudi Arabia": 0.2,
  Senegal: 0.3,
  Serbia: 0.15,
  Seychelles: 0.25,
  "Sierra Leone": 0.25,
  Singapore: 0.17,
  "Sint Maarten (Dutch part)": 0.345,
  Slovakia: 0.21,
  Slovenia: 0.19,
  "Solomon Islands": 0.3,
  "South Africa": 0.27,
  "South Sudan": 0.3,
  Spain: 0.25,
  "Sri Lanka": 0.3,
  "State of Palestine": 0.15,
  Sudan: 0.35,
  Suriname: 0.36,
  Swaziland: 0.275,
  Sweden: 0.206,
  Switzerland: 0.197,
  "Syrian Arab Republic": 0.28,
  Taiwan: 0.2,
  Tajikistan: 0.18,
  Thailand: 0.2,
  "The former Yugoslav Republic of Macedonia": 0.1,
  "Timor-Leste": 0.1,
  Togo: 0.27,
  Tokelau: 0.0,
  Tonga: 0.25,
  "Trinidad and Tobago": 0.3,
  Tunisia: 0.15,
  Turkey: 0.25,
  Turkmenistan: 0.08,
  "Turks and Caicos Islands": 0.0,
  Uganda: 0.3,
  Ukraine: 0.18,
  "United Arab Emirates": 0.09,
  "United Kingdom of Great Britain and Northe": 0.25,
  "United Republic of Tanzania": 0.3,
  "United States of America": 0.258,
  "United States Virgin Islands": 0.231,
  Uruguay: 0.25,
  Uzbekistan: 0.15,
  Vanuatu: 0.0,
  "Venezuela (Bolivarian Republic of)": 0.34,
  "Viet Nam": 0.2,
  "Wallis and Futuna Islands": 0.0,
  Yemen: 0.2,
  Zambia: 0.3,
  Zimbabwe: 0.247,
} as const;

export type TaxCountry = keyof typeof MARGINAL_TAX_BY_COUNTRY;

/**
 * Gets the corporate tax rate for a specific country
 * @param country The country name
 * @returns The corporate tax rate as a decimal (e.g., 0.25 for 25%)
 */
export function getTaxRate(country: string): number | undefined {
  return (MARGINAL_TAX_BY_COUNTRY as Record<string, number>)[country];
}

/**
 * Gets a list of all available countries with tax rates
 * @returns Array of country names
 */
export function getTaxCountries(): string[] {
  return Object.keys(MARGINAL_TAX_BY_COUNTRY).sort();
}

/**
 * Gets the tax rate formatted as a percentage string
 * @param country The country name
 * @returns The tax rate as a percentage string (e.g., "25.0%")
 */
export function getFormattedTaxRate(country: string): string {
  const rate = getTaxRate(country);
  if (rate === undefined) return "N/A";
  return `${(rate * 100).toFixed(1)}%`;
}

/**
 * Finds the closest matching country in the tax data
 * @param query The country name to search for
 * @returns The closest matching country name or null if no match found
 */
export function findClosestTaxCountry(query: string): string | null {
  const countries = getTaxCountries();

  // Direct match
  if (countries.includes(query)) return query;

  // Common mappings
  const countryMappings: Record<string, string> = {
    USA: "United States of America",
    UK: "United Kingdom of Great Britain and Northe",
    GB: "United Kingdom of Great Britain and Northe",
    England: "United Kingdom of Great Britain and Northe",
    UAE: "United Arab Emirates",
    Russia: "Russian Federation",
    Korea: "Republic of Korea",
    "South Korea": "Republic of Korea",
  };

  // Check mapping
  if (countryMappings[query] && countries.includes(countryMappings[query])) {
    return countryMappings[query];
  }

  // Try to find by partial match
  const partialMatches = countries.filter(
    (c) =>
      c.toLowerCase().includes(query.toLowerCase()) ||
      query.toLowerCase().includes(c.toLowerCase())
  );

  if (partialMatches.length > 0) {
    return partialMatches[0];
  }

  return null;
}
